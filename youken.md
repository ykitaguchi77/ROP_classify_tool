# 動画/画像 手動分類アプリ 要件定義書

## 1. はじめに

### 1.1. アプリの目的
本アプリケーションは、動画ファイルまたは複数の画像ファイルを読み込み、動画の場合はフレームごとにJPG画像へ分解、その後各フレーム（または画像）の内容を目視で確認し、「Yes」または「No」の二値分類を手動で行うためのデスクトップツールである。分類結果はCSVファイルとして出力し、途中での作業中断・再開も可能とする。

### 1.2. 対象ユーザー
動画や大量の画像データセットに対して、フレーム単位・画像単位での目視によるラベル付け（分類）作業を必要とする研究者、データ分析者、データアノテーターなどを主な対象ユーザーとする。

## 2. 機能要件

### 2.1. ファイル入力
*   **動画/画像アップロード:**
    *   ユーザーインターフェース上のボタン等から、単一の動画ファイル（一般的な形式、例: MP4, AVI等）または複数の画像ファイル（例: JPG, PNG等）を選択してアップロードできる。
*   **CSV読み込み（再開用）:**
    *   動画または画像ファイルをロードした後、過去に本アプリで出力した、または指定のフォーマットに準拠したCSVファイルを読み込むことができる。（詳細は「2.8. 再開機能」参照）

### 2.2. 動画フレーム分解
*   **処理:** アップロードされた動画ファイルは、**全てのフレーム**をJPG画像ファイルとして抽出・保存する。
*   **保存先:** 抽出されたJPGファイルの保存先フォルダは、ユーザーが指定できる。
*   **ファイル名規則:** `[動画ファイルのベース名]_[フレーム番号(0埋め4桁)].jpg` とする。フレーム番号は `0001` から開始する。 (例: `sample_movie_0001.jpg`, `sample_movie_0125.jpg`)
*   **進捗表示:** フレーム分解処理中は、ユーザーに進捗状況（例: プログレスバーや処理中メッセージ）を表示することが望ましい。

### 2.3. 複数画像ファイルの扱い
*   アップロードされた複数画像ファイルは、分類作業のためにユーザーが指定した作業フォルダにコピーされる。これにより、動画フレームの場合とファイル管理方法を統一し、再開機能の実装を容易にする。
*   ファイル名は元のファイル名を維持する。

### 2.4. 画像表示とナビゲーション
*   **表示:** 現在選択されているフレーム（画像）を画面の主要エリアに表示する。
*   **ナビゲーション:**
    *   「次へ」ボタンをクリックするか、キーボードの「右矢印」キーを押すと、次のフレーム（画像）を表示する。リストの最後に到達した場合は、それ以上進まない（ボタンを無効化するなど）。
    *   「前へ」ボタンをクリックするか、キーボードの「左矢印」キーを押すと、前のフレーム（画像）を表示する。リストの最初に到達した場合は、それ以上戻らない（ボタンを無効化するなど）。

### 2.5. 画像分類
*   **操作:**
    *   画面上に「Yes」ボタンと「No」ボタンを配置する。
    *   「Yes」ボタンをクリックするか、キーボードの「Y」キーを押すと、現在表示中の画像が「Yes」として分類される。
    *   「No」ボタンをクリックするか、キーボードの「N」キーを押すと、現在表示中の画像が「No」として分類される。
*   **上書き:** 既に分類済みの画像に対して再度分類操作を行った場合、新しい分類結果で上書きされる。

### 2.6. 分類状態の視覚化
*   現在表示中の画像の分類状態（Yes / No / 未分類）に応じて、画像表示エリアの**背景色**または**枠線の色**を変更し、ユーザーが直感的に状態を把握できるようにする。
    *   **Yes:** 緑系の色
    *   **No:** 赤系の色
    *   **未分類:** デフォルトの色（例: グレー、白など）

### 2.7. 情報表示
*   画面上に以下の情報を常に表示する。
    *   **現在の画像ファイル名:** (例: `sample_movie_0125.jpg`)
    *   **進捗状況:** 全画像数中の現在の画像の位置を示す。(例: `125 / 1500`)

### 2.8. 再開機能 (CSV読み込み)
*   **トリガー:** 動画または複数画像をロードし、画像が表示されている状態で、「CSV読み込み」ボタン等から既存の分類結果CSVファイルを選択する。
*   **動作:**
    *   CSVファイルの内容を読み込み、`image_name` 列をキーとして、対応する画像の `classification` 列（"Yes" または "No"）を内部的な分類状態に反映させる。CSV上で分類が空欄のものは「未分類」として扱う。
    *   読み込み後、表示は**リストの最初の画像から**開始する。ユーザーは任意の画像に移動し、分類状態を確認したり、再分類したりすることができる。
*   **整合性チェック:** CSVに記載されている `image_name` が、現在ロードされている画像ファイル（動画から分解されたJPG、またはコピーされた画像）のリストに存在しない場合、エラーメッセージを表示するなどの適切な処理を行う。

### 2.9. CSV出力 (Finalize)
*   **トリガー:** 「Finalize」ボタンをクリックする。
*   **動作:**
    *   現在の全ての画像（フレーム）に対する分類状態（Yes / No / 未分類）をリスト化する。
    *   ファイル保存ダイアログを表示し、ユーザーが出力先のフォルダとCSVファイル名を指定できるようにする。
    *   指定された場所にCSVファイルを出力する。
*   **CSVフォーマット:**
    *   文字コード: UTF-8
    *   区切り文字: カンマ (`,`)
    *   ヘッダー行: `frame_index`, `image_name`, `classification`
    *   データ行:
        *   `frame_index`: 1から始まる連番。動画の場合はフレーム番号に相当。複数画像の場合はロード（アップロード）された順序。
        *   `image_name`: 対応する画像ファイル名（動画フレーム分解後の名前、または元の画像ファイル名）。
        *   `classification`: `"Yes"`, `"No"`, または **空欄** (未分類の場合)。
    *   ファイル内の画像の順序は、`frame_index` の昇順とする。

## 3. 非機能要件

### 3.1. 対象プラットフォーム
*   **主:** Windows
*   **副:** macOS (クロスプラットフォーム対応の技術を用い、可能な範囲で動作互換性を確保する)

### 3.2. 使用感 (UI/UX)
*   直感的でシンプルなインターフェースを提供する。
*   マウス操作（ボタンクリック）とキーボードショートカット（Y/Nキーでの分類、左右矢印キーでのナビゲーション）の両方に対応し、効率的な分類作業を支援する。

### 3.3. パフォーマンス
*   大量のフレーム（数千～数万枚）を扱う可能性があるため、画像の読み込みや切り替えが極端に遅くならないよう、メモリ管理や描画処理に配慮する。ただし、現時点での厳密な性能目標値は設けない。

### 3.4. ファイル管理
*   動画から分解されたJPGファイルは、ユーザーが指定したフォルダに永続的に保存される。アプリ終了後もファイルは残る。
*   複数画像をアップロードした場合も、作業用にユーザー指定のフォルダへコピーして管理する。

### 3.5. エラーハンドリング
*   ファイルの読み込みエラー（非対応フォーマット、ファイル破損、アクセス権限等）、CSVのフォーマット不正、再開時のファイル不整合など、想定されるエラー発生時には、ユーザーに分かりやすいメッセージを表示し、可能な限りアプリケーションの強制終了を避ける。

## 4. 画面構成案（テキストベース）
+------------------------------------------------------+
| [動画/画像 選択] [JPG保存先 指定] [CSV読込(再開)] | (ファイル操作エリア)
+------------------------------------------------------+
| |
| +-----------------------------+ |
| | | |
| | | |
| | 現在表示中の画像 | | (画像表示エリア)
| | (背景色/枠線で分類状態表示) | |
| | | |
| +-----------------------------+ |
| Image: [ファイル名] ( [現在位置] / [全枚数] ) | (情報表示エリア)
+------------------------------------------------------+
| [ << 前へ ] [ Yes (Y) ] [ No (N) ] [ 次へ >> ] | (分類・ナビゲーション)
| |
| [ Finalize (CSV出力) ]| (出力ボタン)
+------------------------------------------------------+

## 5. その他/補足事項
*   本要件定義書は、現時点での合意事項を示すものであり、開発途中で必要に応じて見直し・変更が行われる可能性がある。
